<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>ãƒ©ãƒœã”ã£ã¡</title>
  </head>
  <body>
    <div id="game-container">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† -->
      <div id="header">
        <!-- ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºã¨é€²æ—ãƒãƒ¼ -->
        <div id="level-container">
          <p>ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></p>
          <div id="progress-bar">
            <div id="progress-fill" style="width: 30%"></div>
          </div>
          <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚²ãƒ¼ã‚¸ -->
          <div id="status-bars">
            <div id="hunger-gauge" class="circle-gauge">
              <div class="circle">50</div>
              <p>æº€è…¹åº¦</p>
            </div>
            <div id="cleanliness-gauge" class="circle-gauge">
              <div class="circle">50</div>
              <p>æ¸…æ½”åº¦</p>
            </div>
            <div id="comfort-gauge" class="circle-gauge">
              <div class="circle">50</div>
              <p>å¿«é©åº¦</p>
            </div>
            <div id="happiness-gauge" class="circle-gauge">
              <div class="circle">50</div>
              <p>å¹¸ç¦åº¦</p>
            </div>
          </div>
        </div>
        <!-- å³ä¸Šã®æ™‚è¨ˆ -->
        <div id="date-container">
          <div id="clock-container">
            <p id="date"></p>
            <p id="time"></p>
          </div>
        </div>
      </div>

      <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼éƒ¨åˆ† -->
      <div id="character-container">
        <img
          id="character"
          src="images/normal.png"
          alt="ãŸã¾ã”ã£ã¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼"
        />
      </div>

      <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³éƒ¨åˆ† -->
      <div id="action-buttons">
      <!-- ãƒœã‚¿ãƒ³ã®å¤‰æ›´ -->
    <button onclick="showModal('feed')">
      <div class="icon-container">
      <img src="images/carrot.png" alt="é¤Œ" class="button-icon" />
      </div>
      <span>é€²æ—</span>
    </button>

    <button onclick="showModal('bath')">
      <div class="icon-container">
      <img src="images/bath.png" alt="ãŠé¢¨å‘‚" class="button-icon" />
      </div>
      <span>ä¼šè­°å‚åŠ </span>
    </button>

    <button onclick="showModal('toilet')">
      <div class="icon-container">
      <img src="images/toilet.png" alt="ãƒˆã‚¤ãƒ¬" class="button-icon" />
      </div>
      <span>è«–æ–‡èª­ã‚€</span>
    </button>

    <button onclick="showModal('play')">
      <div class="icon-container">
      <img src="images/toy.png" alt="éŠã¶" class="button-icon" />
      </div>
      <span>äº¤æµ</span>
    </button>
        <button onclick="toggleHelp()">
          <div class="icon-container">
            <img src="images/help.png" alt="ãƒ˜ãƒ«ãƒ—" class="button-icon" />
          </div>
          <span>ãƒ˜ãƒ«ãƒ—</span>
        </button>
      </div>
    </div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« (ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—) -->
<div id="action-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="toggleModal()">&times;</span>
    <h2 id="modal-title">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ</h2>
    <p id="modal-progress" style="display: none;">å…¨ä½“é€²æ—åº¦ 0/10000</p> <!-- ä¿®æ­£ -->
    <p id="completed-count" style="display: none;">å®Œäº†æ•°: 0/19</p> <!-- å®Œäº†æ•°è¡¨ç¤º -->
    <label for="new-value" id="new-value-label">é€²æ—åº¦:</label> <!-- ãƒ©ãƒ™ãƒ«ã®IDã‚’è¿½åŠ  -->
    <input type="number" id="new-value" min="0" max="100000" />
    <button onclick="submitAction()">é€ä¿¡</button>
    <button id="complete-button" style="display: none;" onclick="completeReading()">å®Œäº†</button>
  </div>
</div>
    

<!-- ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="help-modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="toggleHelp()">&times;</span>
    <h2>ãŸã¾ã”ã£ã¡è‚²æˆã‚²ãƒ¼ãƒ  - ãƒ«ãƒ¼ãƒ«</h2>
    <p class="intro">
      ç ”ç©¶å®¤ã§ãƒšãƒƒãƒˆã‚’é£¼ã†ã“ã¨ã«ãªã‚Šã¾ã—ãŸ!!!<br />
      <strong>åå‰ã¯ "ãŸã¾ã”ã£ã¡" ã§ã™ã€‚</strong>
    </p>
    <p>è²¬ä»»ã‚’ã‚‚ã£ã¦æ¯æ—¥ã€Œãˆã•ãƒ»ãŠé¢¨å‘‚ãƒ»ãƒˆã‚¤ãƒ¬ãƒ»ãŠæ•£æ­©ã€ã‚’ã“ãªã—ã¾ã—ã‚‡ã†ï¼</p>
    <div class="rules-container">
      <ul class="rules-list">
        <li>
          <span class="rule-icon">ğŸ´</span>
          <strong>ãˆã• (æº€è…¹åº¦):</strong> ç ”ç©¶å®¤ãƒ¡ãƒ³ãƒã®è«–æ–‡ã®é€²æ—ã®åˆè¨ˆã§ãˆã•ã®ãƒ©ãƒ³ã‚¯ãŒæ±ºã¾ã‚Šã¾ã™ï¼
        </li>
        <li>
          <span class="rule-icon">ğŸ›</span>
          <strong>ãŠé¢¨å‘‚ (æ¸…æ½”åº¦):</strong> ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å‚åŠ ã—ãŸäººæ•°ãŒ8å‰²ã‚’æº€ãŸã›ã°ã€ãŠé¢¨å‘‚ã«å…¥ã‚Œã¾ã™ï¼
        </li>
        <li>
          <span class="rule-icon">ğŸš½</span>
          <strong>ãƒˆã‚¤ãƒ¬ (å¿«é©åº¦):</strong> ãƒ¡ãƒ³ãƒãŒèª­ã‚“ã è«–æ–‡ã®ãƒšãƒ¼ã‚¸æ•°ãŒä¸€å®šå€¤ã‚’è¶…ãˆã‚‹ã¨ãƒˆã‚¤ãƒ¬ãŒå¯èƒ½ï¼
        </li>
        <li>
          <span class="rule-icon">ğŸŒŸ</span>
          <strong>ãŠæ•£æ­© (å¹¸ç¦åº¦):</strong> ç ”ç©¶å®¤è¡Œäº‹ã‚’é–‹å‚¬ã™ã‚‹ã”ã¨ã«æ•£æ­©ã«è¡Œã‘ã¾ã™ï¼
        </li>
      </ul>
    </div>
    <p class="notice">
      <strong>æ³¨æ„:</strong> 2ã¤ä»¥ä¸Šã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ80ä»¥ä¸Šã®çŠ¶æ…‹ãŒ3æ—¥ç¶šãã¨ã€ãƒšãƒƒãƒˆã¯ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ã¾ã™ãŒã€ã„ãšã‚Œã‹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ20æœªæº€ã®çŠ¶æ…‹ãŒ2æ—¥ç¶šãã¨ã€ãŸã¾ã”ã£ã¡ã¯å¸°ã‚‰ã¬ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚
    </p>
    <div class="button-container">
      <button class="modal-button" onclick="toggleHelp()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>


    <script src="/socket.io/socket.io.js"></script>
</body>

    <script>
let currentAction = ''; // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
let currentProgress = 0; // ç¾åœ¨ã®é€²æ—åº¦
let completedCount = 0;  // å®Œäº†æ•°
let toiletCount = 0; // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã‚‹ãƒˆã‚¤ãƒ¬ã®æŠ¼ä¸‹äººæ•°

// socket.io æ¥ç¶š
const socket = io();

// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰çŠ¶æ…‹ã‚’å—ã‘å–ã‚‹
socket.on("updateState", (state) => {
  console.log("State updated:", state); // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
  document.querySelector("#hunger-gauge .circle").textContent = state.hunger;
  document.querySelector("#cleanliness-gauge .circle").textContent = state.cleanliness;
  document.querySelector("#comfort-gauge .circle").textContent = state.comfort;
  document.querySelector("#happiness-gauge .circle").textContent = state.happiness;
});

// é€²æ—åº¦ã®æ›´æ–°ã‚’å—ã‘å–ã‚‹
socket.on("progressUpdate", (progress) => {
  currentProgress = progress;
  updateModalProgress(); // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’æ›´æ–°
});
socket.on("toiletProgressUpdate", (total) => {
  const completedCountElement = document.getElementById("completed-count");
  completedCountElement.textContent = `å®Œäº†æ•°: ${total}/19`; // åˆè¨ˆäººæ•°ã‚’æ›´æ–°
});


function showModal(action) {
  currentAction = action; // ç¾åœ¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜

  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆæœŸåŒ–
  const modalTitle = document.getElementById("modal-title");
  const progressElement = document.getElementById("modal-progress");
  const newValueLabel = document.getElementById("new-value-label");
  const completedCountElement = document.getElementById("completed-count");
  const input = document.getElementById("new-value");

  // ã™ã¹ã¦éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆåˆæœŸåŒ–ï¼‰
  progressElement.style.display = "none";
  completedCountElement.style.display = "none";
  input.style.display = "block"; // å…¥åŠ›æ¬„ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º

  // ãƒœã‚¿ãƒ³ã®ç¨®é¡ã«å¿œã˜ãŸè¨­å®š
if (action === "feed") {
  modalTitle.innerHTML = "<span style='color:#FF6347'>ğŸ é¤Œã‚’ã‚ã’ã‚‹</span>";
  newValueLabel.textContent = "é€²æ—åº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:";
  progressElement.style.display = "block"
  } else if (action === "bath") {
  modalTitle.innerHTML = "<span style='color:#00BFFF'>ğŸ› ãŠé¢¨å‘‚ã‚¿ã‚¤ãƒ </span>";
  newValueLabel.textContent = "å‚åŠ äººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:";
} else if (action === "toilet") {
  modalTitle.innerHTML = "<span style='color:#6A5ACD'>ğŸš½ ãƒˆã‚¤ãƒ¬ãƒã‚§ãƒƒã‚¯</span>";
  newValueLabel.textContent = "èª­ã‚“ã è«–æ–‡ã®æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:";
} else if (action === "play") {
  modalTitle.innerHTML = "<span style='color:#FF69B4'>ğŸ‰ éŠã³ã®æ™‚é–“</span>";
  newValueLabel.textContent = "è¦ªç¦ä¼šã®ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’è¨˜å…¥:";
  input.style.display = "none"; // å…¥åŠ›æ¬„ã‚’éè¡¨ç¤º
}

  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  document.getElementById("action-modal").style.display = "block";


  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®é€²æ—åº¦è¡¨ç¤ºã‚’æ›´æ–°
function updateModalProgress() {
  const progressElement = document.getElementById("modal-progress");
  progressElement.textContent = `å…¨ä½“é€²æ—åº¦ ${currentProgress}/10000`;
}
  // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®é€²æ—åº¦è¡¨ç¤ºã‚’æ›´æ–°
  updateModalProgress();
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  document.getElementById("action-modal").style.display = "block";
}



// ä¼šè­°å‚åŠ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸå ´åˆ
function submitAction() {
  const newValue = parseInt(document.getElementById("new-value").value, 10);
  
  if (currentAction === 'bath') {
    // äººæ•°ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã€15/19ä»¥ä¸Šã§æ¸…æ½”åº¦ã‚’100ã«è¨­å®š
    const participants = parseInt(newValue);
    if (participants >= 15) {
      socket.emit("action", { action: currentAction, value: 100 }); // æ¸…æ½”åº¦100ã«è¨­å®š
      alert("ä¼šè­°å‚åŠ äººæ•°ãŒååˆ†ã§ã™!æ¸…æ½”åº¦ãŒ100ã«è¨­å®šã•ã‚Œã¾ã—ãŸã€‚");
    } else {
      socket.emit("action", { action: currentAction, value: participants }); // æ¸…æ½”åº¦ã®æ›´æ–°ã¯ã—ãªã„
    }
  } else if (currentAction === "toilet" && !isNaN(newValue)) {
    socket.emit("action", { action: currentAction, value: newValue }); // ã‚µãƒ¼ãƒãƒ¼ã«äººæ•°ã‚’é€ä¿¡
    document.getElementById("new-value").value = ""; // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
    toggleModal(); // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  }
  else {
    // é€²æ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆfeedï¼‰ã®å ´åˆã¯é€²æ—åº¦ã‚’é€ä¿¡
    if (newValue !== '') {
      socket.emit("action", { action: currentAction, value: parseInt(newValue) });
      toggleModal(); // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    } else {
      alert("å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    }
  }}
// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function toggleModal() {
  document.getElementById("action-modal").style.display = "none";
}



    </script>
    <!-- JavaScript -->
    <script>
      // æ™‚è¨ˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°
      function updateClock() {
        const now = new Date();
        const date = now.toLocaleDateString("ja-JP", {
          year: "numeric",
          month: "long",
          day: "numeric",
          weekday: "long",
        });
        const time = now.toLocaleTimeString("ja-JP", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        document.getElementById("date").textContent = date; // æ—¥ä»˜ã‚’è¡¨ç¤º
        document.getElementById("time").textContent = time; // æ™‚é–“ã‚’è¡¨ç¤º
      }

      // 1ç§’ã”ã¨ã«æ™‚è¨ˆã‚’æ›´æ–°
      setInterval(updateClock, 1000);
      updateClock(); // åˆæœŸå€¤ã®è¨­å®š

      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
      function action(type) {
        console.log(`${type} ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸï¼`);
      }

      // ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
      function toggleHelp() {
        const modal = document.getElementById("help-modal");
        modal.style.display =
          modal.style.display === "block" ? "none" : "block";
      }
    </script>

  </body>
</html>
